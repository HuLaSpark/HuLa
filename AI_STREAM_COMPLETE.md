# AI æµå¼æ•°æ®æ¸²æŸ“å®Œæˆ

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### 1. åç«¯ SSE æ•°æ®æ¥æ”¶ âœ…
- Rust åç«¯æˆåŠŸæ¥æ”¶ SSE æµå¼æ•°æ®
- æ­£ç¡®è§£ææœåŠ¡å™¨è¿”å›çš„ JSON æ ¼å¼æ•°æ®
- é€šè¿‡ Tauri äº‹ä»¶ç³»ç»Ÿå‘é€åˆ°å‰ç«¯

### 2. å‰ç«¯æ•°æ®è§£æ âœ…
- å‰ç«¯æˆåŠŸæ¥æ”¶ Tauri äº‹ä»¶
- æ­£ç¡®è§£æ JSON æ•°æ®ï¼Œæå– `data.receive.content` å­—æ®µ
- å®æ—¶æ›´æ–°æ¶ˆæ¯å†…å®¹

### 3. UI å®æ—¶æ¸²æŸ“ âœ…
- æ·»åŠ æ¶ˆæ¯åˆ—è¡¨æ˜¾ç¤º
- å®æ—¶æ›´æ–° AI å›å¤å†…å®¹
- æµå¼å…‰æ ‡åŠ¨ç”»æ•ˆæœ
- è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨

## ğŸ“Š æ•°æ®æµç¨‹

```
æœåŠ¡å™¨ SSE æµ
  â†“
data:{"success":true,"data":{"receive":{"content":"JavaScript"}}}
  â†“
Rust åç«¯æ¥æ”¶å¹¶è§£æ
  â†“
emit('ai-stream-event', { data: JSONå­—ç¬¦ä¸² })
  â†“
å‰ç«¯ listen('ai-stream-event')
  â†“
è§£æ JSON.parse(chunk)
  â†“
æå– data.data.receive.content
  â†“
æ›´æ–° messageList[index].content
  â†“
Vue å“åº”å¼æ›´æ–° UI
  â†“
å®æ—¶æ˜¾ç¤ºåœ¨èŠå¤©ç•Œé¢
```

## ğŸ¨ UI åŠŸèƒ½

### æ¶ˆæ¯æ˜¾ç¤º
- âœ… ç”¨æˆ·æ¶ˆæ¯ï¼šå³å¯¹é½ï¼Œç»¿è‰²æ°”æ³¡
- âœ… AI æ¶ˆæ¯ï¼šå·¦å¯¹é½ï¼Œé»˜è®¤æ°”æ³¡
- âœ… æµå¼å…‰æ ‡ï¼šé—ªçƒçš„å…‰æ ‡æ•ˆæœ `â–‹`
- âœ… è‡ªåŠ¨æ»šåŠ¨ï¼šæ–°æ¶ˆæ¯è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨

### æ¶ˆæ¯ç»“æ„
```typescript
interface Message {
  type: 'user' | 'assistant'
  content: string
  streaming?: boolean  // æ˜¯å¦æ­£åœ¨æµå¼è¾“å‡º
  timestamp?: number
}
```

## ğŸ”§ å…³é”®ä»£ç ä¿®æ”¹

### Chat.vue ä¸»è¦æ”¹åŠ¨

1. **æ·»åŠ æ¶ˆæ¯åˆ—è¡¨çŠ¶æ€**
```typescript
const messageList = ref<Message[]>([])
const chatContainerRef = ref<HTMLElement | null>(null)
```

2. **å®æ—¶æ›´æ–°æ¶ˆæ¯å†…å®¹**
```typescript
onChunk: (chunk: string) => {
  try {
    const data = JSON.parse(chunk)
    if (data.success && data.data?.receive?.content) {
      messageList.value[aiMessageIndex].content = data.data.receive.content
      scrollToBottom()
    }
  } catch (e) {
    console.error('è§£æJSONå¤±è´¥:', e)
  }
}
```

3. **æ¶ˆæ¯åˆ—è¡¨æ¸²æŸ“**
```vue
<template v-for="(message, index) in messageList" :key="index">
  <!-- ç”¨æˆ·æ¶ˆæ¯ -->
  <n-flex v-if="message.type === 'user'" :size="6" justify="end">
    ...
  </n-flex>
  
  <!-- AIæ¶ˆæ¯ -->
  <n-flex v-else :size="6">
    <div class="bubble">
      <span v-if="message.streaming" class="streaming-cursor">
        {{ message.content }}
      </span>
      <span v-else>{{ message.content }}</span>
    </div>
  </n-flex>
</template>
```

4. **æµå¼å…‰æ ‡åŠ¨ç”»**
```css
.streaming-cursor::after {
  content: 'â–‹';
  animation: blink 1s infinite;
}

@keyframes blink {
  0%, 50% { opacity: 1; }
  51%, 100% { opacity: 0; }
}
```

## ğŸ“ æœåŠ¡å™¨æ•°æ®æ ¼å¼

æœåŠ¡å™¨è¿”å›çš„ SSE æ•°æ®æ ¼å¼ï¼š
```
data:{"success":true,"code":200,"data":{"send":{"id":"89799684200960","type":"user","content":"ä»€ä¹ˆæ˜¯js"},"receive":{"id":"89799684200961","type":"assistant","content":"JavaScript"}},"msg":"","path":null,"version":null,"timestamp":"1761736321008"}

data:{"success":true,"code":200,"data":{"send":{"id":"89799684200960","type":"user","content":"ä»€ä¹ˆæ˜¯js"},"receive":{"id":"89799684200961","type":"assistant","content":"éå¸¸é€‚åˆ"}},"msg":"","path":null,"version":null,"timestamp":"1761736321008"}

...
```

æ¯ä¸ªæ•°æ®å—åŒ…å«ï¼š
- `success`: æ˜¯å¦æˆåŠŸ
- `data.send`: ç”¨æˆ·å‘é€çš„æ¶ˆæ¯
- `data.receive.content`: AI å›å¤çš„å†…å®¹ï¼ˆé€æ­¥ç´¯ç§¯ï¼‰
- `timestamp`: æ—¶é—´æˆ³

## ğŸ¯ æµ‹è¯•æ­¥éª¤

1. **å¯åŠ¨åº”ç”¨**
   ```bash
   pnpm tauri dev
   ```

2. **æ‰“å¼€ ChatBot çª—å£**
   - ç‚¹å‡»å·¦ä¾§ Robot æ’ä»¶å›¾æ ‡

3. **é€‰æ‹© AI æ¨¡å‹**
   - ç‚¹å‡»"å½“å‰æ¨¡å‹"æ ‡ç­¾
   - é€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„æ¨¡å‹

4. **å‘é€æ¶ˆæ¯**
   - åœ¨è¾“å…¥æ¡†è¾“å…¥é—®é¢˜ï¼Œä¾‹å¦‚ï¼š"ä»€ä¹ˆæ˜¯ JavaScriptï¼Ÿ"
   - ç‚¹å‡»å‘é€æˆ–æŒ‰å›è½¦

5. **è§‚å¯Ÿæ•ˆæœ**
   - âœ… ç”¨æˆ·æ¶ˆæ¯ç«‹å³æ˜¾ç¤ºåœ¨å³ä¾§
   - âœ… AI æ¶ˆæ¯å ä½ç¬¦å‡ºç°åœ¨å·¦ä¾§
   - âœ… AI å›å¤å†…å®¹é€å­—é€å¥å®æ—¶æ›´æ–°
   - âœ… æµå¼å…‰æ ‡é—ªçƒæ•ˆæœ
   - âœ… è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
   - âœ… æµç»“æŸåå…‰æ ‡æ¶ˆå¤±

## ğŸ› è°ƒè¯•ä¿¡æ¯

### å‰ç«¯æ§åˆ¶å°è¾“å‡º
```
ğŸ¯ Chaté¡µé¢æ”¶åˆ°AIå‘é€è¯·æ±‚: {å†…å®¹: 'ä»€ä¹ˆæ˜¯js', å½“å‰æ¨¡å‹: 'gpt-3.5-turbo', ...}
ğŸš€ å¼€å§‹å‘é€AIæ¶ˆæ¯: {å†…å®¹: 'ä»€ä¹ˆæ˜¯js', æ¨¡å‹: 'gpt-3.5-turbo', ...}
ğŸ“¨ æ”¶åˆ°AIæµå¼æ•°æ®: JavaScript
ğŸ“¨ æ”¶åˆ°AIæµå¼æ•°æ®: éå¸¸é€‚åˆ
ğŸ“¨ æ”¶åˆ°AIæµå¼æ•°æ®: å¼€å‘
...
âœ… AIæµå¼å“åº”å®Œæˆ
âœ… AIæ¶ˆæ¯å‘é€æˆåŠŸ
```

### Rust åç«¯æ—¥å¿—
```
[INFO] ğŸ¤– å¼€å§‹å‘é€ AI æµå¼æ¶ˆæ¯è¯·æ±‚, conversation_id: xxx, request_id: xxx
[INFO] ğŸ“¡ SSE Request URL: http://192.168.1.37:18760/ai/chat/message/send-stream
[INFO] âœ… SSE è¿æ¥å·²å»ºç«‹ï¼Œå¼€å§‹ç›‘å¬æµå¼æ•°æ®...
[INFO] ğŸ” æ”¶åˆ°åŸå§‹æ•°æ®å— (é•¿åº¦: 365): "data:{...}"
[INFO] ğŸ“¨ æ”¶åˆ° SSE æ•°æ® (æ— ç©ºæ ¼): {"success":true,...}
...
[INFO] âœ… SSE æµæ­£å¸¸ç»“æŸï¼Œæ€»å†…å®¹é•¿åº¦: xxx
[INFO] ğŸ SSE æµå¤„ç†å®Œæˆ
```

## ğŸ‰ åŠŸèƒ½æ¼”ç¤º

### æµå¼è¾“å‡ºæ•ˆæœ
```
ç”¨æˆ·: ä»€ä¹ˆæ˜¯ JavaScriptï¼Ÿ

AI: Jâ–‹                    (0.1ç§’)
AI: JavaScriptâ–‹          (0.2ç§’)
AI: JavaScript æ˜¯â–‹       (0.3ç§’)
AI: JavaScript æ˜¯ä¸€ç§â–‹   (0.4ç§’)
...
AI: JavaScript æ˜¯ä¸€ç§éå¸¸é€‚åˆå¼€å‘å•é¡µåº”ç”¨ï¼Œç”¨æˆ·çš„æ“ä½œä¸éœ€è¦...  (å®Œæˆ)
```

## ğŸ“‹ æ–‡ä»¶æ¸…å•

### ä¿®æ”¹çš„æ–‡ä»¶
- âœ… `src/plugins/robot/views/Chat.vue` - æ·»åŠ æ¶ˆæ¯åˆ—è¡¨å’Œå®æ—¶æ¸²æŸ“
- âœ… `src-tauri/src/command/ai_command.rs` - æ·»åŠ è°ƒè¯•æ—¥å¿—

### æ–°å¢çš„æ–‡ä»¶
- âœ… `AI_STREAM_COMPLETE.md` - æœ¬æ–‡æ¡£

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

1. **æ¶ˆæ¯æŒä¹…åŒ–**
   - å°†æ¶ˆæ¯ä¿å­˜åˆ°æ•°æ®åº“
   - åˆ·æ–°åæ¢å¤å†å²æ¶ˆæ¯

2. **Markdown æ¸²æŸ“**
   - æ”¯æŒä»£ç é«˜äº®
   - æ”¯æŒè¡¨æ ¼ã€åˆ—è¡¨ç­‰æ ¼å¼

3. **æ¶ˆæ¯æ“ä½œ**
   - å¤åˆ¶æ¶ˆæ¯
   - åˆ é™¤æ¶ˆæ¯
   - é‡æ–°ç”Ÿæˆ

4. **æ€§èƒ½ä¼˜åŒ–**
   - è™šæ‹Ÿæ»šåŠ¨ï¼ˆæ¶ˆæ¯è¿‡å¤šæ—¶ï¼‰
   - æ¶ˆæ¯åˆ†é¡µåŠ è½½

5. **ç”¨æˆ·ä½“éªŒ**
   - åœæ­¢ç”ŸæˆæŒ‰é’®
   - æ¶ˆæ¯åŠ è½½åŠ¨ç”»
   - é”™è¯¯é‡è¯•æœºåˆ¶

## âœ¨ æ€»ç»“

AI æµå¼æ•°æ®åŠŸèƒ½å·²ç»å®Œå…¨å®ç°å¹¶å¯ä»¥æ­£å¸¸å·¥ä½œï¼

- âœ… åç«¯æˆåŠŸæ¥æ”¶ SSE æµå¼æ•°æ®
- âœ… å‰ç«¯æˆåŠŸè§£æ JSON æ•°æ®
- âœ… UI å®æ—¶æ¸²æŸ“ AI å›å¤
- âœ… æµå¼å…‰æ ‡åŠ¨ç”»æ•ˆæœ
- âœ… è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°æ¶ˆæ¯
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†

ç°åœ¨ä½ å¯ä»¥åœ¨èŠå¤©ç•Œé¢çœ‹åˆ° AI çš„å›å¤åƒæ‰“å­—ä¸€æ ·é€å­—é€å¥åœ°å‡ºç°ï¼Œå°±åƒçœŸäººåœ¨è¾“å…¥ä¸€æ ·ï¼ğŸ‰

